YUI.add("fluid-avatar-editor-view",function(t){"use strict";var o={dragging:{mouseDownX:0,mouseDownY:0,previousX:0,previousY:0,centerX:0,centerY:0,startDrag:!1,overlayDiameter:0},zoom:{scale:1,scaleFactor:1,mouseDownX:0,previousX:0,startDrag:!1,midpoint:0,height:0,width:0,max:0,min:0,isLowQuality:!1},potential:{height:0,width:0,url:"",x:0,y:0},original:{x:0,y:0}};t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.set("photoModel",t.photoModel),this.contentHeight=t.contentHeight,o.zoom.scale=1,o.dragging.startDrag=!1,o.zoom.startDrag=!1,this},loadState:function(){return t.Promise.resolve()},buildContainer:function(t){return this.setContainerWithTemplate("fluid-avatar-editor",{contentHeight:this.contentHeight}),this},activate:function(){return this.avatarBackground=this.get("container").one(".avatar-background"),this.avatarFocus=this.get("container").one(".avatar-image"),this.zoomHandle=this.get("container").one(".zoom-handle"),this.containerWidth=this.get("container").get("offsetWidth"),this.containerHeight=this.get("container").get("offsetHeight"),this.loadAvatarPhoto(),this},showTooltip:function(){this.zoomTooltip||(this.zoomTooltip=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showDropArrow:!0,width:150,anchorElement:this.zoomHandle,textMessage:this.intlMessage({intlName:"header.MIN_ZOOM"}),invisibleOverlay:!0,classList:"over-modal",overlayClassList:"over-modal"})),this.zoomTooltip.show()},hideTooltip:function(){this.zoomTooltip&&!this.zoomTooltip.isClosed&&this.zoomTooltip.close()},loadAvatarPhoto:function(){var t,e=new Image;e.onload=this.handleImageLoad.bind(this),t=this.get("photoModel").getLargestSize(),o.potential.width=t.width,o.potential.height=t.height,o.potential.url=t.url,o.zoom.width=t.width*o.zoom.scale,o.zoom.height=t.height*o.zoom.scale,e.src=t.url,(e.complete||e.onloadFired)&&this.handleImageLoad()},handleImageLoad:function(){var t=this.get("container"),e=t.one(".avatar-clip");o.dragging.centerX=-1*(o.potential.width/2-this.containerWidth/2),o.dragging.centerY=-1*(o.potential.height/2-this.containerHeight/2),o.dragging.overlayDiameter=parseInt(e.getStyle("width"),10)/2,this.offsetLeft=this.containerWidth/2-o.dragging.overlayDiameter,this.offsetTop=this.containerHeight/2-o.dragging.overlayDiameter,o.potential.x=o.dragging.centerX,o.potential.y=o.dragging.centerY,o.original.x=o.dragging.centerX,o.original.y=o.dragging.centerY,this.saveParamsForAPI(),t.one(".avatar-image").setStyles({backgroundImage:"url("+o.potential.url+")",width:o.potential.width+"px",height:o.potential.height+"px",left:o.dragging.centerX+-1*this.offsetLeft+"px",top:o.dragging.centerY+-1*this.offsetTop+"px"}),t.one(".avatar-background").setStyles({backgroundImage:"url("+o.potential.url+")",width:o.potential.width+"px",height:o.potential.height+"px",left:o.dragging.centerX+"px",top:o.dragging.centerY+"px"}),this.setupEventListeners(),this.setupZoomHandler()},setupEventListeners:function(){var e=this.get("container"),i=e.one(".avatar-background"),a=e.one(".avatar-image"),n=e.one(".controls-area"),r=this;this.registerEventHandler(i.on(["mousedown","touchstart"],function(t){t.halt(),o.dragging.mouseDownY=t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0),o.dragging.mouseDownX=t.pageX||(t.touches&&t.touches.length?t.touches[0].pageX:0),o.dragging.previousY=parseInt(i.getStyle("top"),10),o.dragging.previousX=parseInt(i.getStyle("left"),10),o.dragging.startDrag=!0,i.addClass("grabbing"),n.addClass("clickthrough")})),this.registerEventHandler(i.on(["mousemove","touchmove"],function(t){if(t.halt(),o.dragging.startDrag){var e=o.dragging.mouseDownY-(t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0)),n=o.dragging.mouseDownX-(t.pageX||(t.touches&&t.touches.length?t.touches[0].pageX:0)),s=o.dragging.previousY-e,g=o.dragging.previousX-n,h=r.snapFocusToFit(g,s);g=h.x,s=h.y,o.potential.x=g,o.potential.y=s,o.original.x=(r.containerWidth-r.containerWidth/o.zoom.scale)/2+o.potential.x/o.zoom.scale,o.original.y=(r.containerHeight-r.containerHeight/o.zoom.scale)/2+o.potential.y/o.zoom.scale,r.saveParamsForAPI(),i.setStyle("left",g),i.setStyle("top",s),a.setStyle("left",g+-1*r.offsetLeft),a.setStyle("top",s+-1*r.offsetTop)}})),this.registerEventHandler(t.one("body").on(["mouseup","touchend"],function(){o.dragging.startDrag=!1,i.removeClass("grabbing"),n.removeClass("clickthrough")})),this.registerEventHandler(i.on(["mouseup","touchend"],function(){o.dragging.startDrag=!1,i.removeClass("grabbing"),n.removeClass("clickthrough")}))},determineBoundaries:function(){return{minX:o.dragging.centerX+o.zoom.width/2-o.dragging.overlayDiameter,minY:o.dragging.centerY+o.zoom.height/2-o.dragging.overlayDiameter,maxX:o.dragging.centerX-o.zoom.width/2+o.dragging.overlayDiameter,maxY:o.dragging.centerY-o.zoom.height/2+o.dragging.overlayDiameter}},snapFocusToFit:function(t,o){var e=this.determineBoundaries();return t=t<=e.minX?t:e.minX,t=t>=e.maxX?t:e.maxX,o=o<=e.minY?o:e.minY,o=o>=e.maxY?o:e.maxY,{x:t,y:o}},setupZoomHandler:function(){var e,i=this,a=this.get("container"),n=a.one(".controls-area"),r=a.one(".zoom-controls"),s=a.one(".zoom-plus"),g=a.one(".zoom-minus");o.zoom.max=parseInt(r.get("offsetWidth"),10)-parseInt(this.zoomHandle.get("offsetWidth"),10),o.zoom.previousX=parseInt(this.zoomHandle.getStyle("left"),10),o.zoom.scaleFactor=1/(o.zoom.max/4),o.zoom.midpoint=o.zoom.max/2,e=Math.max(2*o.dragging.overlayDiameter/o.potential.width,2*o.dragging.overlayDiameter/o.potential.height),o.zoom.min=2*(e-.25)/o.zoom.scaleFactor,o.zoom.min>o.zoom.max&&(o.zoom.isLowQuality=!0,this.zoomHandle.setStyle("left",o.zoom.max)),a.one(".low-quality-zone").setStyle("width",Math.min(o.zoom.min,o.zoom.max)),o.zoom.scale=Math.max(o.zoom.min,o.zoom.midpoint)*o.zoom.scaleFactor/2+.25,this.updateImageScale(),this.registerEventHandler(this.zoomHandle.on(["mousedown","touchstart"],this.onZoomBarClicked.bind(this))),this.registerEventHandler(n.on(["mousemove","touchmove"],this.onZoomBarMoved.bind(this))),this.registerEventHandler(s.on("click",this.zoomByIncrement.bind(this))),this.registerEventHandler(g.on("click",this.zoomByIncrement.bind(this))),this.registerEventHandler(a.on(["mouseup","touchend"],function(t){t.halt(),o.zoom.startDrag=!1,i.zoomHandle.removeClass("dragging")})),this.registerEventHandler(t.one("body").on(["mouseup","touchend"],function(t){o.zoom.startDrag=!1,i.zoomHandle.removeClass("dragging")}))},onZoomBarClicked:function(t){t.halt(),o.zoom.mouseDownX=t.pageX||(t.touches&&t.touches.length?t.touches[0].pageX:0),o.zoom.startDrag=!0,o.zoom.previousX=parseInt(this.zoomHandle.getStyle("left"),10),this.zoomHandle.addClass("dragging")},onZoomBarMoved:function(t){if(t.halt(),o.zoom.startDrag){var e=o.zoom.mouseDownX-(t.pageX||(t.touches&&t.touches.length?t.touches[0].pageX:0)),i=o.zoom.previousX-e;i=(i=i<=o.zoom.min?o.zoom.min:i)>=o.zoom.max?o.zoom.max:i,o.zoom.scale=i*o.zoom.scaleFactor/2+.25,i<=o.zoom.min&&o.zoom.isLowQuality?this.showTooltip():(i===o.zoom.min?this.showTooltip():this.hideTooltip(),this.zoomHandle.setStyle("left",i),this.updateImageScale())}},zoomByIncrement:function(t){var e,i=parseInt(this.zoomHandle.getStyle("left"));t&&(t.halt(),t.target.hasClass("zoom-plus")?e=i+parseInt(o.zoom.max/10):t.target.hasClass("zoom-minus")&&(e=i-parseInt(o.zoom.max/10)),(e=(e=e<=o.zoom.min?o.zoom.min:e)>=o.zoom.max?o.zoom.max:e)<=o.zoom.min&&o.zoom.isLowQuality?this.showTooltip():(e===o.zoom.min?this.showTooltip():this.hideTooltip(),o.zoom.previousX=e,o.zoom.scale=e*o.zoom.scaleFactor/2+.25,this.zoomHandle.setStyle("left",e),this.updateImageScale()))},updateImageScale:function(){var t,e,i;o.zoom.width=o.potential.width*o.zoom.scale,o.zoom.height=o.potential.height*o.zoom.scale,o.dragging.centerX=-1*(o.zoom.width/2-this.containerWidth/2),o.dragging.centerY=-1*(o.zoom.height/2-this.containerHeight/2),t=(this.containerWidth-this.containerWidth*o.zoom.scale)/2+o.original.x*o.zoom.scale,e=(this.containerHeight-this.containerHeight*o.zoom.scale)/2+o.original.y*o.zoom.scale,t=(i=this.snapFocusToFit(t,e)).x,e=i.y,o.potential.x=t,o.potential.y=e,this.saveParamsForAPI(),this.avatarBackground.setStyles({width:o.zoom.width+"px",height:o.zoom.height+"px",left:t+"px",top:e+"px"}),this.avatarFocus.setStyles({width:o.zoom.width+"px",height:o.zoom.height+"px",left:t+-1*this.offsetLeft+"px",top:e+-1*this.offsetTop+"px"})},saveParamsForAPI:function(){var e=o.zoom.width/2-(o.potential.x-o.dragging.centerX),i=o.zoom.height/2-(o.potential.y-o.dragging.centerY);e/=o.zoom.scale,i/=o.zoom.scale,this.set("apiParams",{x1:parseInt(e-o.dragging.overlayDiameter/o.zoom.scale),x2:parseInt(e+o.dragging.overlayDiameter/o.zoom.scale),y1:parseInt(i-o.dragging.overlayDiameter/o.zoom.scale),y2:parseInt(i+o.dragging.overlayDiameter/o.zoom.scale),url:t.URLHelper.addProtocolToURL(o.potential.url)})},destructor:function(){return this.hideTooltip(),this.constructor.superclass.destroy.call(this)}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-avatar-editor","url-helper","fluid-droparound-view"],langBundles:["header"]});YUI.add("hermes-template-coverphoto-context-menu",function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="follow-options">\n\t\t\t<div class="mark-as-heading">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"header.MARK_AS_LABEL"},data:o,loc:{start:{line:4,column:32},end:{line:4,column:80}}}))+'</div>\n\t\t\t<div class="toggle-container friend-toggle-container"></div>\n\t\t\t<div class="toggle-container family-toggle-container"></div>\n\t\t</div>\n'},3:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=i(e,"if").call(r,null!=t?i(t,"canEditCoverPhoto"):t,{name:"if",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:3},end:{line:15,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showHideFromFeed"):t,{name:"if",hash:{},fn:n.program(6,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:3},end:{line:22,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showMute"):t,{name:"if",hash:{},fn:n.program(11,o,0),inverse:n.noop,data:o,loc:{start:{line:23,column:3},end:{line:29,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"canReport"):t,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:30,column:3},end:{line:32,column:10}}}))?a:"")+"\n"},4:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="context-item" data-id="change-coverphoto">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.CHANGE_COVER_PHOTO"},data:o,loc:{start:{line:14,column:57},end:{line:14,column:111}}}))+"</li>\n"},6:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isHiddenFromFeed"):t,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.program(9,o,0),data:o,loc:{start:{line:17,column:4},end:{line:21,column:11}}}))?a:""},7:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="show-in-feed">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.SHOW_GROUP_FEED"},data:o,loc:{start:{line:18,column:53},end:{line:18,column:103}}}))+"</li>\n"},9:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="hide-from-feed">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.HIDE_GROUP_FEED"},data:o,loc:{start:{line:20,column:55},end:{line:20,column:105}}}))+"</li>\n"},11:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isMuted"):t,{name:"if",hash:{},fn:n.program(12,o,0),inverse:n.program(14,o,0),data:o,loc:{start:{line:24,column:4},end:{line:28,column:11}}}))?a:""},12:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="unmute-notifications">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.UNMUTE_NOTIFICATIONS"},data:o,loc:{start:{line:25,column:61},end:{line:25,column:116}}}))+"</li>\n"},14:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="mute-notifications">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.MUTE_NOTIFICATIONS"},data:o,loc:{start:{line:27,column:59},end:{line:27,column:112}}}))+"</li>\n"},16:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="context-item" data-id="report">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.REPORT_ABUSE"},data:o,loc:{start:{line:31,column:46},end:{line:31,column:93}}}))+"</li>\n"},18:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"viewingSelf"):t,{name:"if",hash:{},fn:n.program(19,o,0),inverse:n.program(22,o,0),data:o,loc:{start:{line:36,column:3},end:{line:63,column:10}}}))?a:"")+"\t\t\t\n"},19:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\t\t\t"+(null!=(a=c(e,"if").call(r,null!=t?c(t,"canEditCoverPhoto"):t,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:37,column:4},end:{line:37,column:148}}}))?a:"")+'\n\t\t\t\t<li class="context-item link" data-id="edit-username"><a href="/account#profile-details-settings">'+s((c(e,"intlMessage")||t&&c(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"header.EDIT_USERNAME"},data:o,loc:{start:{line:38,column:102},end:{line:38,column:150}}}))+'</a></li>\n\t\t\t\t<li class="context-item link" data-id="edit-real-name"><a href="/account#profile-details-settings">'+s((c(e,"intlMessage")||t&&c(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"header.EDIT_REAL_NAME"},data:o,loc:{start:{line:39,column:103},end:{line:39,column:152}}}))+"</a></li>\n"},20:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<li class="context-item" data-id="change-coverphoto">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.CHANGE_COVER_PHOTO"},data:o,loc:{start:{line:37,column:82},end:{line:37,column:136}}}))+"</li>"},22:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=i(e,"if").call(r,null!=t?i(t,"showGiftPro"):t,{name:"if",hash:{},fn:n.program(23,o,0),inverse:n.noop,data:o,loc:{start:{line:41,column:4},end:{line:45,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isBlocked"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(25,o,0),data:o,loc:{start:{line:46,column:4},end:{line:52,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showBlock"):t,{name:"if",hash:{},fn:n.program(28,o,0),inverse:n.noop,data:o,loc:{start:{line:53,column:4},end:{line:59,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"canReport"):t,{name:"if",hash:{},fn:n.program(33,o,0),inverse:n.noop,data:o,loc:{start:{line:60,column:4},end:{line:62,column:11}}}))?a:"")},23:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="gift-pro">\n\t\t\t\t\t\t'+n.escapeExpression((a(e,"outlet")||t&&a(t,"outlet")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?a(t,"gift-pro-view"):t,{name:"outlet",hash:{},data:o,loc:{start:{line:43,column:6},end:{line:43,column:30}}}))+"\n\t\t\t\t\t</li>\n"},25:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isBlockedBy"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(26,o,0),data:o,loc:{start:{line:47,column:5},end:{line:51,column:12}}}))?a:""},26:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item link" data-id="send-message">\n\t\t\t\t\t\t\t<a href="'+s("function"==typeof(a=null!=(a=c(e,"flickrMailUrl")||(null!=t?c(t,"flickrMailUrl"):t))?a:i)?a.call(r,{name:"flickrMailUrl",hash:{},data:o,loc:{start:{line:49,column:16},end:{line:49,column:33}}}):a)+'">'+s((c(e,"intlMessage")||t&&c(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"photo-card.SEND_A_MESSAGE"},data:o,loc:{start:{line:49,column:35},end:{line:49,column:88}}}))+"</a>\n\t\t\t\t\t\t</li>\n"},28:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isBlocked"):t,{name:"if",hash:{},fn:n.program(29,o,0),inverse:n.program(31,o,0),data:o,loc:{start:{line:54,column:5},end:{line:58,column:12}}}))?a:""},29:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item" data-id="unblock">'+n.escapeExpression((a(e,"intlHTMLMessage")||t&&a(t,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlHTMLMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"photo-card.UNBLOCK_USER"},data:o,loc:{start:{line:55,column:49},end:{line:55,column:125}}}))+"</li>\n"},31:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item" data-id="block">'+n.escapeExpression((a(e,"intlHTMLMessage")||t&&a(t,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlHTMLMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"photo-card.BLOCK_USER"},data:o,loc:{start:{line:57,column:47},end:{line:57,column:121}}}))+"</li>\n"},33:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="report">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"header.REPORT_USERNAME"},data:o,loc:{start:{line:61,column:47},end:{line:61,column:118}}}))+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="coverphoto-context-menu">\n'+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isFollowing"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:2,column:1},end:{line:8,column:8}}}))?a:"")+'\n\t<ul class="context-list">\n'+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isGroup"):t,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.program(18,o,0),data:o,loc:{start:{line:11,column:2},end:{line:65,column:9}}}))?a:"")+"\t</ul>\n</div>\n"},useData:!0}),l={};n.Array.each([],function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)}),n.Template.register("hermes/coverphoto-context-menu",function(t,o){return o=o||{},o.partials=o.partials?n.merge(l,o.partials):l,e(t,o)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("coverphoto-context-menu-view",function(e,i){"use strict";var t=require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var t;return i.recipientNsid=i.pageNsid,this.params=i,this.params.isPersonPro=!!this.params.personModel&&this.params.personModel.getValue("isPro"),this.params.isFollowing=!!this.params.relationshipModel&&this.params.relationshipModel.getValue("isContact"),this.params.personModel&&(t=e.URLHelper.generatePersonUrls(this.params.personModel),this.params.flickrMailUrl=t.sendFlickrMail,this.params.displayname=this.params.personModel.getValue("displayname")),this},subviewConfig:{"gift-pro-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,placement:"context-menu",disabled:function(e){return!this.appContext.flipper.isFlipped("enable-gift-pro")||e.isGroup}}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("flickr-balls"),this},activate:function(){var i=this,t=this.get("container"),r=[];return t.addClass("loading"),i.params.isGroup&&(r.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(t){return t?t.remoteReadUserPrefs({object_type:1},i.appContext):e.Promise.resolve()}).then(function(t){if(t&&t.userFeedPref){var r=t.userFeedPref.filter(function(e){return e.objectId===i.params.groupId});i.isHiddenFromFeed=r.length>0&&"0"===r[0].prefValue}return e.Promise.resolve()})),r.push(this.params.groupStatusHelper.load().then(function(){i.params.groupStatusHelper.update()}))),e.Promise.all(r).then(function(e){var r={};if(i.params.isGroup){var o=i.params.groupStatusHelper.getInfo();r={isGroup:!0,isHiddenFromFeed:i.isHiddenFromFeed,isMuted:o.groupAttrs.muted,canReport:!0,showHideFromFeed:o.groupAttrs.isMember,showMute:o.groupAttrs.isMember,canEditCoverPhoto:i.params.canEditCoverPhoto}}else r={isPersonPro:i.params.isPersonPro,isFollowing:i.params.isFollowing,flickrMailUrl:i.params.flickrMailUrl,isHiddenFromFeed:i.isHiddenFromFeed,canEditCoverPhoto:i.params.canEditCoverPhoto,viewingSelf:i.params.viewingSelf,showGiftPro:!i.params.isPersonPro&&!i.params.viewingSelf,isBlocked:!!i.params.relationshipModel&&i.params.relationshipModel.getValue("isIgnored"),isBlockedBy:!!i.params.relationshipModel&&i.params.relationshipModel.getValue("isIgnoredBy"),canReport:!0,displayname:i.params.displayname,showBlock:i.appContext.getViewer().signedIn};return i.setContainerWithTemplate("coverphoto-context-menu",r),i.friendToggleNode=t.one(".friend-toggle-container"),i.familyToggleNode=t.one(".family-toggle-container"),i.getSubviews()}).then(function(){return i.insertSubviews()}).then(function(){i.registerEventHandler(t.delegate("click",i.handleItemClick.bind(i),".context-item")),t.removeClass("loading"),setTimeout(function(){e.fire("droparound:reposition")},0)})},getSubviews:function(){var i=[],t=this;return this.params.isFollowing&&(i.push(this.appContext.getView("toggle-component-view",{type:"check",id:"coverphoto-context-mark-as-friend",labelText:this.intlMessage({intlName:"common.FRIEND"}),isBlock:!0,isChecked:this.params.relationshipModel.getValue("isFriend")}).then(function(e){return t.friendToggleView=e,e.initialize()})),i.push(this.appContext.getView("toggle-component-view",{type:"check",id:"coverphoto-context-mark-as-family",labelText:this.intlMessage({intlName:"common.FAMILY"}),isBlock:!0,isChecked:this.params.relationshipModel.getValue("isFamily")}).then(function(e){return t.familyToggleView=e,e.initialize()}))),e.Promise.all(i)},insertSubviews:function(){var i=this,t=[];return this.friendToggleView&&(this.friendToggleNode.append(this.friendToggleView.get("container")),t.push(this.friendToggleView.activate())),this.familyToggleView&&(this.familyToggleNode.append(this.familyToggleView.get("container")),t.push(this.familyToggleView.activate())),e.Promise.all(t).then(function(){i.friendToggleView&&i.registerEventHandler(i.friendToggleView.on("toggled",i.handleFriendChange.bind(i))),i.familyToggleView&&i.registerEventHandler(i.familyToggleView.on("toggled",i.handleFamilyChange.bind(i)))})},handleItemClick:function(e){switch(e.target.ancestor(".context-item",!0).getData("id")){case"change-coverphoto":this.fire("changeCoverphoto");break;case"hide-from-feed":this.fire("hideFromFeed");break;case"show-in-feed":this.fire("showInFeed");break;case"mute-notifications":this.fire("muteNotifications");break;case"unmute-notifications":this.fire("unmuteNotifications");break;case"block":this.fire("block");break;case"unblock":this.fire("unblock");break;case"report":this.fire("report");break;case"gift-pro":this.fire("giftPro")}},handleFriendChange:function(e){var i=this,r=this.params.relationshipModel,o=e.isChecked;return r.setValue("isFriend",o),r.remoteUpdate().catch(function(e){r.setValue("isFriend",!o),i.friendToggleView.toggleCheckedState(!o),t.error({err:e}),i.fire("friendChangeError")})},handleFamilyChange:function(e){var i=this,r=this.params.relationshipModel,o=e.isChecked;return r.setValue("isFamily",o),r.remoteUpdate().catch(function(e){r.setValue("isFamily",!o),i.familyToggleView.toggleCheckedState(!o),t.error({err:e}),i.fire("familyChangeError")})}})},"@VERSION@",{requires:["flickr-view","hermes-template-coverphoto-context-menu","hermes-template-flickr-balls","url-helper"],langBundles:["header","common","groups","photo-card","gallery"]});YUI.add("fluid-coverphoto-editor",function(t){"use strict";var e,o=this.details.langBundles;e={dragging:{mouseDownY:0,previousY:0},potential:{y:0,height:0,width:0,url:"",id:0,aspectRatio:0},original:{width:0,height:0,url:""}},t.FluidCoverPhotoEditor=function(t,i){this.coverPhotoElement=t,e.original.url=t.getStyle("backgroundImage"),this.langBundles=o,this.appContext=i},t.FluidCoverPhotoEditor.prototype.loadCoverPhoto=function(o){var i,n,a,r=new Image,s=this;return new t.Promise(function(t,l){r.onload=function(){a=s._determineBoundaries(e.potential.height,e.potential.width),s.coverPhotoElement.setStyles({backgroundImage:"url("+r.src+")",backgroundPosition:"50% "+-1*a.min+"px",height:parseInt(s.coverPhotoElement.get("offsetHeight"),10)-parseInt(s.coverPhotoElement.getStyle("padding-top"),10)-parseInt(s.coverPhotoElement.getStyle("padding-bottom"),10)}),s.coverPhotoElement.addClass("editing"),s.setupEditorHandlers(),t()},e.potential.id=o.id,n=o.getValue("descendingSizes")[0],i=o.getValue("descendingSizes")[1],e.potential.width=i.width,e.potential.height=i.height,e.potential.url=i.url,e.original.width=n.width,e.original.height=n.height,e.potential.aspectRatio=o.getValue("aspectRatio"),r.src=i.url})},t.FluidCoverPhotoEditor.prototype._convertYPositionForApi=function(t,o){var i,n,a,r=parseInt(this.coverPhotoElement.get("offsetHeight"),10),s=parseInt(this.coverPhotoElement.get("offsetWidth"),10);return e.potential.aspectRatio!==e.original.width/e.original.height&&(o=e.original.height),i=Math.abs(t)+r/2,n=2048*i/s,a=n-384,a*o/2048},t.FluidCoverPhotoEditor.prototype._determineBoundaries=function(t,e){var o,i,n,a,r,s=parseInt(this.coverPhotoElement.get("offsetWidth"),10),l=parseInt(this.coverPhotoElement.get("offsetHeight"),10);return o=s*t/e,384,n=384*s/2048,i=n-l/2,a=o-i,r=a-l,{min:i,max:r}},t.FluidCoverPhotoEditor.prototype.setupEditorHandlers=function(){var o=this,i=this._determineBoundaries(e.potential.height,e.potential.width);t.one(t.config.win.document.documentElement).addClass("disable-text-select"),this.coverPhotoElement.on(["mousedown","touchstart"],function(t){var i=o.coverPhotoElement.getStyle("backgroundPosition").split(" "),n=2===i.length?parseInt(i[1],10):0;e.dragging.mouseDownY=t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0)||(t.touches&&t.touches.length?t.touches[0].pageY:0),e.dragging.previousY=n,e.dragging.startDrag=!0,o.coverPhotoElement.addClass("grabbing")}),this.coverPhotoElement.on(["mouseup","touchend"],function(){e.dragging.startDrag=!1,o.coverPhotoElement.removeClass("grabbing")}),this.coverPhotoElement.on(["mouseout","touchcancel"],function(){e.dragging.startDrag=!1,o.coverPhotoElement.removeClass("grabbing")}),this.coverPhotoElement.on(["mousemove","touchmove"],function(t){if(t.halt(),e.dragging.startDrag){var n=e.dragging.mouseDownY-(t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0)),a=e.dragging.previousY-n,r=-1*i.min,s=-1*i.max;a=(a=a>=s?a:s)>r?r:a,e.potential.y=a,o.coverPhotoElement.setStyle("backgroundPosition","50% "+a+"px")}})},t.FluidCoverPhotoEditor.prototype.cancelCoverPhotoEditing=function(){this.coverPhotoElement.removeClass("editing"),this.coverPhotoElement.setStyles({backgroundImage:e.original.url,backgroundPosition:"50% 50%",height:null}),this.coverPhotoElement.detachAll(),t.one(t.config.win.document.documentElement).removeClass("disable-text-select")},t.FluidCoverPhotoEditor.prototype.saveCoverPhoto=function(o){var i,n=this._convertYPositionForApi(e.potential.y,e.original.width),a={photo_id:e.potential.id,y:n};o&&(a.group_id=o,i="group"),this.coverPhotoElement.addClass("saving"),t.coverPhotoSaver.save(a,i).then(function(){t.config.win.location.reload()}).catch(function(e){var o=new t.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),textMessage:e.message,appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!1});o.show(),o.on("actionClick",function(e){t.config.win.location.reload()})}.bind(this))},t.mix(t.FluidCoverPhotoEditor.prototype,t.Localizable)},"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom"],langBundles:["common"]});YUI.add("coverphoto-saver",function(o){"use strict";o.coverPhotoSaver={methods:{photostream:"flickr.coverphoto.setAccountCover",group:"flickr.coverphoto.setGroupCover"},save:function(t,e){var r=o.config.win.appContext,c={group_id:t.group_id,photo_id:t.photo_id,x:Math.abs(t.x||0),y:Math.abs(t.y||0)},i=this.methods[e||"photostream"];return new o.Promise(function(o,t){r.callAPI(i,c).then(function(e){var c=0,i=function(){r.callAPI("flickr.photos.upload.checkTickets",{tickets:e.coverphoto.ticketId}).then(function(e){var r=e&&e.uploader.ticket[0];c++,r&&1===r.complete?o():c>5?t():setTimeout(i,2e3)})};e&&e.coverphoto&&e.coverphoto.ticketId&&setTimeout(i,2e3)},function(o){t(new Error("Cover photo could not be saved. "+o.message))})})}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("avatar-saver",function(e){"use strict";e.AvatarSaver={methods:{people:"flickr.people.setBuddyIcon",group:"flickr.groups.setBuddyIcon"},save:function(t,o){var c=e.config.win.appContext,i=this.methods[o||"people"];return new e.Promise(function(e,o){c.callAPI(i,t).then(function(t){var i=0,n=function(){c.callAPI("flickr.photos.upload.checkTickets",{tickets:t.ticketid.content}).then(function(t){var c=t&&t.uploader.ticket[0];i++,c&&1===c.complete?e():i>5?o():setTimeout(n,2e3)})};t&&t.ticketid&&setTimeout(n,2e3)},function(e){o(new Error("Cover photo could not be saved."))})})}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-profile-setProfile-updater",function(e,i){"use strict";e.namespace("ModelUpdaters")["flickr-profile-setProfile"]={run:function(l,r){var t=(function(e){var i={};return i.extras="full_response,expand_bbml,social_urls","profileDescription"===e.field?e.field="description":"website"===e.field&&(e.field="website_url"),i[e.field]=e.value,i})(l);return new e.FlickrPromise({apiResponse:r.callAPI("flickr.profile.setProfile",t),personPublicProfileModel:r.getModel("person-public-profile-models",l.id)}).then(function(e){return(function(e,i,l,r){var t=e.apiResponse,o=e.personPublicProfileModel;if(t){var s=t[l.field],f={stat:t.stat,field:l.field,value:s};return"description"===l.field?(l.field="profileDescription",o.setValue("profileDescription",t.description),o.setValue("profileDescriptionExpanded",t.descriptionExpanded)):"website_url"===l.field?(l.field="website",o.setValue("website",s)):["instagram","facebook","tumblr","pinterest","twitter"].indexOf(l.field)>-1?(o.setValue(l.field,t[l.field]),o.setValue(l.field+"Url",t[l.field+"Url"])):void 0===s?o.setValue(l.field,i[l.field]):o.setValue(l.field,s),f}})(e,t,l)}.bind(this),e.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-public-profile-models"]});YUI.add("person-public-profile-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-profile-getProfile"].run(t,this.appContext)},updateField:function(t,r){return e.ModelUpdaters["flickr-profile-setProfile"].run(t,r)}},remoteUpdateDescription:function(e,t,r){return this.setValue(e,"description",t.description),this.remote.updateBioField(t,r)},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},joinedDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},showcaseSetId:{defaultValue:"0"},city:{},country:{},firstName:{},lastName:{},hometown:{},email:{},occupation:{},profileDescription:{},profileDescriptionExpanded:{},timezone:{},website:{},facebook:{},facebookUrl:{},instagram:{},instagramUrl:{},tumblr:{},tumblrUrl:{},twitter:{},twitterUrl:{},pinterest:{},pinterestUrl:{},totalViews:{},totalTags:{},totalGeotagged:{},totalFaves:{},totalInGroup:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-profile-getProfile-fetcher","flickr-profile-setProfile-updater"]});