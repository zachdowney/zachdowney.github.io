YUI.add("hermes-template-fluid-magic-search",function(e,n){var a=e.Template.Handlebars.revive({1:function(e,n,a,t,l){var r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return e.escapeExpression((r(a,"intlMessage")||n&&r(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"search.SEARCH_PHOTOSTREAM"},data:l,loc:{start:{line:1,column:81},end:{line:1,column:133}}}))},3:function(e,n,a,t,l){var r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return e.escapeExpression((r(a,"intlMessage")||n&&r(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"search.SEARCH_FAVORITES"},data:l,loc:{start:{line:1,column:141},end:{line:1,column:191}}}))},5:function(e,n,a,t,l){return'data-track="addContextPhotostream"'},7:function(e,n,a,t,l){return'data-track="addContextFaves"'},compiler:[8,">= 4.3.0"],main:function(e,n,a,t,l){var r,o=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<a href="#" class="search-toggle" title="'+(null!=(r=(i(a,"ifCond")||n&&i(n,"ifCond")||s).call(o,null!=n?i(n,"pageType"):n,"===","photostream",{name:"ifCond",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l,loc:{start:{line:1,column:41},end:{line:1,column:202}}}))?r:"")+'" '+(null!=(r=(i(a,"ifCond")||n&&i(n,"ifCond")||s).call(o,null!=n?i(n,"pageType"):n,"===","photostream",{name:"ifCond",hash:{},fn:e.program(5,l,0),inverse:e.program(7,l,0),data:l,loc:{start:{line:1,column:204},end:{line:1,column:325}}}))?r:"")+'><span></span></a>\n<input tabindex="-1" class="magic-search" placeholder="'+(null!=(r=(i(a,"ifCond")||n&&i(n,"ifCond")||s).call(o,null!=n?i(n,"pageType"):n,"===","photostream",{name:"ifCond",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l,loc:{start:{line:2,column:55},end:{line:2,column:216}}}))?r:"")+'" type="text" value=""></input>\n'},useData:!0}),t={};e.Array.each([],function(n){var a=e.Template.get("hermes/"+n);a&&(t[n]=a)}),e.Template.register("hermes/fluid-magic-search",function(n,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,a(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-magic-search-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fluid-magic-search-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.selected=e.subnavConfig?e.subnavConfig.selected:"",this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(e){this.set("personModel",e)}.bind(this))},buildContainer:function(){return this.setContainerWithTemplate("fluid-magic-search",{pageType:this.selected}),this},handleSearchContextRemoval:function(){this.get("container").one(".search-toggle > span").removeClass("active")},activate:function(){var t=this.get("container").one(".magic-search");return t&&(this.registerEventHandler(this.get("container").one(".search-toggle").on("click",this.toggleSearch.bind(this))),this.registerEventHandler(t.on("keyup",this.performSearch.bind(this))),this.registerEventHandler(this.get("container").one(".search-toggle").on(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this)))),this.registerEventHandler(e.on("remove-context-in-search-field",this.handleSearchContextRemoval.bind(this))),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".fluid-magic-search-view");t&&t.toggleClass("has-keyboard-focus")},toggleSearch:function(t){this.get("container");t.halt(),e.fire("add-context-to-search-field",{name:this.get("personModel").getValue("displayname"),id:this.nsid,type:"user",scope:this.selected}),t.target.addClass("active")},performSearch:function(t){var i,s=this.get("container").one(".magic-search").get("value");t.keyCode&&13!==t.keyCode||(t.halt(),"photostream"===this.selected?i=new e.SearchUrl({userId:this.nsid,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):"favorites"===this.selected&&(i=this.nsid===this.appContext.getViewer().nsid?new e.SearchUrl({faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):new e.SearchUrl({userId:this.nsid,faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS)),i.setSearchTerm(s),this.appContext.flapp.navigate(i.getURL()))}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-fluid-magic-search","search-url"],langBundles:["common","search","fluid-toolbar"]});