YUI.add("albums-list-route",function(e){function t(e){t.superclass.constructor.call(this,e)}var a=require("hermes-core/type-validator");e.Routes[this.name]=t,e.extend(t,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(t){var s,o,i,n=this,r={},l=t.params.nsid_or_path_alias,u=t.params&&t.params.set_id,m=u?100:25,p=this.getPageNumber(t),g=t.geo;return a.nsid(l)?r.id=l:r.pathAlias=l,o="/photos/"+l+"/albums/",s={page:100/m*(p-1)+1,perPage:m,withSetId:u},e.Promise.all([this.appContext.getModel("sets-models",r,s),this.appContext.getModel("person-models",r),this.appContext.getModel("person-contacts-count-models",r)]).then(function(r){var m=r[0],d=r[1],c=0;if(YUI.Env.isServer&&(c=Math.ceil(m.getValue("totalItems")/100),p>c&&s.page>1&&!isNaN(parseInt(t.params.page_number,10))))return e.Promise.resolve({redirect:o.replace(/page[0-9]+/,"")});if(u){var h=m.getValue("albumsList");if(-1===(i=h.getPageOf({id:u},50))||h.getNextIncompletePage(s)===i)return s.forceAPICall=!0,a.nsid(l)?s.id=l:s.pathAlias=l,h.getPage(s).then(function(e){return p=Math.ceil(50*h.getPageOf({id:u},50)/100),i=p,n.onRouteResolved(m,d,p,i,o,u,g)},function(t){return e.Promise.resolve({redirect:o})});p=Math.ceil(50*i/100),i=p}else i=2*(p-1)+1;return n.onRouteResolved(m,d,p,i,o,u,g)},function(a){return a&&u?e.Promise.resolve({redirect:o}):a.timeout?n.appContext.getModel("person-models",r).then(function(t){var a=t.getValue("displayname"),s={view:"empty-page-view",layout:"scrolling",title:n.intlMessage({intlName:"common.USERS_ALBUMS",who:a}),params:{isSlow:!0,page:"albums",displayName:a,nsid:t.getValue("nsid")}};return e.Promise.resolve(s)},function(){return n.onRouteRejected(a,t)}):n.onRouteRejected(a,t)})},onRouteResolved:function(t,a,s,o,i,n,r){var l,u=t.getValue("totalItems"),m=a.getValue("displayname");return l=0===parseInt(u,10)?{view:"empty-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:m}),params:{displayName:m,nsid:a.getValue("nsid"),page:"albums",geo:r}}:{view:"albums-list-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:m}),params:{nsid:t.id,withSetId:n,pageParams:{page:o,perPage:n?100:50,viewPageSize:100,nominalPage:s},geo:r,baseURL:i}},e.Promise.resolve(l)},onRouteRejected:function(t,a){if(t.fatal)throw t;return this.displayRouteErrors(a,new e.RouteError(404,this.intlMessage({intlName:"common.404_PERSON_NONEXISTENT"})))}}),e.mix(t.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models"],langBundles:["common"]});