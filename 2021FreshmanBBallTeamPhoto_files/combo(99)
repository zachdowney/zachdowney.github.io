YUI.add("hermes-template-download-tooltip",function(n,e){var t=n.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(n,e,t,a,l){var o,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,c=n.escapeExpression,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"<div>\n\t"+c("function"==typeof(o=null!=(o=s(t,"content")||(null!=e?s(e,"content"):e))?o:i)?o.call(r,{name:"content",hash:{},data:l,loc:{start:{line:2,column:1},end:{line:2,column:12}}}):o)+'\n\t<br/>\n\t<br/>\n\t<a class="close-onboarding">'+c("function"==typeof(o=null!=(o=s(t,"confirmationLink")||(null!=e?s(e,"confirmationLink"):e))?o:i)?o.call(r,{name:"confirmationLink",hash:{},data:l,loc:{start:{line:5,column:29},end:{line:5,column:49}}}):o)+"</a>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/download-tooltip",function(e,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("bulk-downloader-view",function(e,t){"use strict";e.BulkDownloaderView=e.Base.create("BulkDownloaderView",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.localizeLib=e.mix({langBundles:["common","album-page","cameraroll"],appContext:this.appContext},e.Localizable),this.set("isOwnAlbum",t.isOwnAlbum),this.doOffline=!!t.doOffline},showLoadingDialog:function(){return new e.Views.FluidModal({appContext:this.appContext,showCancelButton:!1,showFooter:!1,showActionButton:!1,title:this.intlMessage({intlName:"cameraroll.PREPARING_DOWNLOAD"}),message:this.templates("flickr-balls")({}),classList:"bulk-download-loading-dialog"}).show()},createTitle:function(e,t){var o="";if(e=e||0,t=t||0,e>0&&t>0)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS_AND_VIDEO",photoCount:e,videoCount:t});else if(e>0&&0===t)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e});else{if(!(0===e&&t>0))throw new Error(this.intlMessage({intlName:"cameraroll.DOWNLOAD_NOT_AVAILABLE_ERROR"}));o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})}return o},createButtonLabel:function(e,t){var o="";return t+e>1?o=this.intlMessage({intlName:"album-page.DOWNLOAD_ZIP"}):1===e&&0===t?o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e}):0===e&&1===t&&(o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})),o},prepareArchive:function(e){var t=this;return this.appContext.callAPI("flickr.download.archives.create",e).then(function(e){var o,n,i=e.archive.countPhotos,a=e.archive.countVideos,l=[],s=e.archive.key;return o=t.createTitle(i,a),n=t.createButtonLabel(i,a),l=e.archive.urls.map(function(e,t){return{url:e,partSequence:t+1}}),{title:o,downloadURLs:l,buttonLabel:n,key:s}}).catch(function(e){throw 105===e.code?new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})):new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"}))})},showDownloadDialog:function(o){var n,i,a=o.title,l=this,s=o.downloadURLs||[];return this.doOffline&&((n=o.setID?{set_id:o.setID}:o.share_code?{share_code:o.share_code,gp_code:o.gp_code,gp_owner:o.gp_owner}:{photo_ids:o.photoIDs,owner_id:o.ownerID}).extras="offline_enabled"),i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!this.doOffline,showCancelButton:!!this.doOffline,showFooter:!!this.doOffline,showActionButton:!!this.doOffline,actionButtonLabel:this.doOffline?this.intlMessage({intlName:"downloadr.CREATE_ZIP"}):"",title:a,message:this.templates("bulk-download-modal")({isMany:s.length>1,downloadURLs:s,buttonLabel:o.buttonLabel,isOwnAlbum:this.get("isOwnAlbum"),doOffline:this.doOffline,loggedOut:!this.appContext.getViewer().signedIn}),classList:"bulk-download-dialog"}).show(),l.doOffline?(i.on("actionClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.get("container").one(".copyright").setHTML(l.templates("flickr-balls")({})),l.prepareArchive(n).then(function(e){i.close(),l.appContext.getViewer().signedIn?l.showTooltip(e.key):l.appContext.flapp.navigate("/download/"+e.key)}).catch(function(t){105===t.code?l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})),i):(e.config.win.beaconError("[bulk-download] Error creating archive ",e.config.win.location.href,t),l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"})),i))})}),i.on("cancelClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"archiveCancelClick"),i.close()})):i.on("activated",function(){i.get("container").all(".butt").on("click",function(o){1===s.length?(e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.close()):(e.rapidTracker.beacon(t,"partialArchiveDownloadClick"),o.target.addClass("is-disabled"))})}),i},onError:function(t,o){o&&o.close(),new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t.message,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showTooltip:function(t){var o=e.one(".global-nav-view").one(".notifications-menu-view"),n=this;if(o){this.tooltip=new e.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("download-tooltip")({content:this.intlHTMLMessage({intlName:"downloadr.TOOLTIP_DOWNLOAD_LINK_MESSAGE",url:"/download/"+t}),confirmationLink:this.intlMessage({intlName:"downloadr.TOOLTIP_OK"})}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:o,keyboardAnchorElement:o,minVerticalSpace:400,width:350,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetVertical:0});var i=this.tooltip.get("container");n.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),n.tooltip.close()},".close-onboarding")),this.tooltip.show()}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-bulk-download-modal","hermes-template-download-tooltip","hermes-template-flickr-balls"],langBundles:["common","downloadr","album-page","cameraroll"],optional:[],affinity:"client"});